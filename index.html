<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>SK ‚Äì Private OTT</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Simple password gate (NOT real security) -->
  <div id="lock-screen" class="lock-screen">
    <div class="lock-card">
      <h1>SK üîê</h1>
      <p>Private access only</p>
      <input
        type="password"
        id="access-code"
        placeholder="Enter access code"
      />
      <button id="unlock-btn">Unlock</button>
      <p id="lock-error" class="error-msg"></p>
    </div>
  </div>

  <!-- Main app -->
  <div id="app" class="app hidden">
    <header class="header">
      <div class="logo">
        <span class="logo-main">SK</span>
        <span class="logo-sub">Private OTT</span>
      </div>

      <div class="header-right">
        <input
          type="text"
          id="search-input"
          placeholder="Search movies..."
          class="search-input"
        />
        <button id="reload-btn" class="reload-btn" title="Reload from Supabase">
          ‚ü≥
        </button>
        <button id="admin-toggle" class="admin-btn">
          Admin
        </button>
      </div>
    </header>

    <main class="main">
      <section class="filters">
        <select id="genre-filter" class="filter-select">
          <option value="">All genres</option>
          <option value="Action">Action</option>
          <option value="Drama">Drama</option>
          <option value="Comedy">Comedy</option>
          <option value="Romance">Romance</option>
          <option value="Sci-Fi">Sci-Fi</option>
          <option value="Thriller">Thriller</option>
          <option value="Horror">Horror</option>
          <option value="Documentary">Documentary</option>
          <option value="Animation">Animation</option>
          <option value="Sports">Sports</option>
          <option value="Other">Other</option>
        </select>
      </section>

      <!-- Admin Panel (no JSON boxes) -->
      <section id="admin-panel" class="admin-panel hidden">
        <h2>Admin ‚Äì Add / Edit Library</h2>
        <p class="admin-hint">
          1) Upload video to <strong>Google Drive</strong> ‚Üí get share link<br />
          2) Use this form to save movies in Supabase database.
        </p>

        <!-- Add movie form -->
        <form id="admin-form" class="admin-form">
          <div class="form-row">
            <label for="admin-title">Title</label>
            <input type="text" id="admin-title" required />
          </div>

          <div class="form-row two-col">
            <div>
              <label for="admin-year">Year</label>
              <input
                type="number"
                id="admin-year"
                min="1900"
                max="2100"
                value="2025"
              />
            </div>
            <div>
              <label for="admin-genre">Genre</label>
              <select id="admin-genre">
                <option value="">Select genre</option>
                <option value="Action">Action</option>
                <option value="Drama">Drama</option>
                <option value="Comedy">Comedy</option>
                <option value="Romance">Romance</option>
                <option value="Sci-Fi">Sci-Fi</option>
                <option value="Thriller">Thriller</option>
                <option value="Horror">Horror</option>
                <option value="Documentary">Documentary</option>
                <option value="Animation">Animation</option>
                <option value="Sports">Sports</option>
                <option value="Other">Other (custom)</option>
              </select>
            </div>
          </div>

          <div class="form-row hidden" id="custom-genre-row">
            <label for="admin-genre-custom">Custom genre (for "Other")</label>
            <input
              type="text"
              id="admin-genre-custom"
              placeholder="Eg: Fantasy, Biopic, etc."
            />
          </div>

          <div class="form-row">
            <label for="admin-desc">Description</label>
            <textarea
              id="admin-desc"
              rows="3"
              placeholder="Short description..."
            ></textarea>
          </div>

          <div class="form-row">
            <label for="admin-thumb">Thumbnail URL</label>
            <input
              type="text"
              id="admin-thumb"
              placeholder="https://... (poster image URL)"
            />
            <small class="hint">
              Tip: Use https://via.placeholder.com/300x450?text=My+Movie or a direct image URL.
            </small>
            <div class="thumb-preview-wrapper">
              <div class="thumb-preview-label">Preview:</div>
              <img id="thumb-preview" class="thumb-preview" alt="Thumbnail preview" />
            </div>
          </div>

          <div class="form-row">
            <label for="admin-source">Google Drive link or File ID</label>
            <input
              type="text"
              id="admin-source"
              placeholder="Drive share link or file id"
              required
            />
            <small class="hint">
              Must be a video with Drive sharing set to "Anyone with the link ‚Äì Viewer".
            </small>
          </div>

          <div class="form-row">
            <label for="admin-source-preview">Final video URL (auto)</label>
            <input
              type="text"
              id="admin-source-preview"
              readonly
            />
            <small class="hint">
              This is the URL SK uses to play the video. It updates automatically.
            </small>
          </div>

          <button type="submit" class="admin-submit-btn">
            ‚ûï Add movie to database
          </button>
        </form>

        <!-- Current movies list with delete -->
        <div class="admin-movie-list-block">
          <h3>Current movies in database</h3>
          <p class="admin-hint">
            Click <strong>Delete</strong> to remove an entry from Supabase.
          </p>
          <div id="admin-movie-list" class="admin-movie-list"></div>
        </div>
      </section>

      <!-- Movie grid -->
      <section id="movie-list" class="movie-grid"></section>
    </main>
  </div>

  <!-- Player modal -->
  <div id="player-modal" class="modal hidden">
    <div class="modal-content">
      <button id="close-modal" class="close-btn">‚úï</button>

      <div class="modal-layout">
        <div class="player-wrapper">
          <div id="player-loading" class="player-loading hidden">
            <div class="spinner"></div>
            <span>Loading video...</span>
          </div>
          <div id="player-error" class="player-error hidden"></div>
          <video
            id="player-video"
            controls
            playsinline
            preload="metadata"
          ></video>
        </div>

        <div class="player-info">
          <h2 id="player-title"></h2>
          <p id="player-meta" class="player-meta"></p>
          <p id="player-desc" class="player-desc"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Supabase client FIRST -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    // ‚¨áÔ∏è REPLACE THESE TWO LINES WITH REAL VALUES FROM Supabase Settings ‚Üí API
    const supabaseUrl = "https://xneiwdmxyakqoalmckug.supabase.co";
    const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhuZWl3ZG14eWFrcW9hbG1ja3VnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MTkwNTIsImV4cCI6MjA4MDA5NTA1Mn0.iIjVhdC6dGsPuYe-DjhOyOO0lzUD9IuyEj3I89CfFJ4";

    const supabase = createClient(supabaseUrl, supabaseAnonKey);
    window.supabase = supabase; // expose to script.js
  </script>

  <!-- Main logic -->
  <script src="script.js" defer></script>
</body>
</html>
